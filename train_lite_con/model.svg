<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="820" viewBox="0 0 1200 820">
  <defs>
    <style>
      .box { fill: #e8f1fb; stroke: #1f77b4; stroke-width: 2; rx: 10; ry: 10; }
      .box-alt { fill: #f6efe8; stroke: #d27c2c; stroke-width: 2; rx: 10; ry: 10; }
      .box-green { fill: #e9f7ef; stroke: #2ca25f; stroke-width: 2; rx: 10; ry: 10; }
      .title { font: bold 20px sans-serif; fill: #111; }
      .label { font: 14px sans-serif; fill: #111; }
      .small { font: 12px sans-serif; fill: #222; }
      .arrow { stroke: #333; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .dash { stroke-dasharray: 6 4; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
    </marker>
  </defs>

  <text x="600" y="36" text-anchor="middle" class="title">Original Model (Lite/Con) Detailed Framework</text>

  <!-- Inputs -->
  <rect class="box" x="50" y="80" width="250" height="70" />
  <text class="label" x="175" y="110" text-anchor="middle">History (Lh,N,C)</text>
  <text class="label" x="175" y="130" text-anchor="middle">Dynamic Features</text>

  <rect class="box" x="50" y="170" width="250" height="70" />
  <text class="label" x="175" y="200" text-anchor="middle">Static Features</text>
  <text class="label" x="175" y="220" text-anchor="middle">(N, Fs)</text>

  <rect class="box" x="50" y="260" width="250" height="70" />
  <text class="label" x="175" y="290" text-anchor="middle">Future Known</text>
  <text class="label" x="175" y="310" text-anchor="middle">(Lf,N,Fk)</text>

  <rect class="box" x="50" y="350" width="250" height="70" />
  <text class="label" x="175" y="380" text-anchor="middle">Adjacency Matrix</text>
  <text class="label" x="175" y="400" text-anchor="middle">Dense Graph</text>

  <!-- DID construction -->
  <rect class="box-alt" x="50" y="470" width="250" height="110" />
  <text class="label" x="175" y="500" text-anchor="middle">DID Feature Builder</text>
  <text class="small" x="175" y="522" text-anchor="middle">Policy + Beta Curves</text>
  <text class="small" x="175" y="542" text-anchor="middle">own/amp/ec/tc/total</text>
  <text class="small" x="175" y="562" text-anchor="middle">mu_comps (Lf,N,5)</text>

  <rect class="box-alt" x="50" y="600" width="250" height="90" />
  <text class="label" x="175" y="630" text-anchor="middle">Residual Target</text>
  <text class="small" x="175" y="652" text-anchor="middle">e = y - mu_total</text>
  <text class="small" x="175" y="672" text-anchor="middle">(for residual mode)</text>

  <!-- Context Encoder -->
  <rect class="box" x="360" y="140" width="260" height="160" />
  <text class="label" x="490" y="175" text-anchor="middle">Context Encoder</text>
  <text class="small" x="490" y="200" text-anchor="middle">spatio-temporal blocks</text>
  <text class="small" x="490" y="220" text-anchor="middle">hist + static + known</text>
  <text class="small" x="490" y="240" text-anchor="middle">→ context embeddings</text>

  <!-- Noise / diffusion -->
  <rect class="box-green" x="360" y="340" width="260" height="120" />
  <text class="label" x="490" y="375" text-anchor="middle">Forward Diffusion</text>
  <text class="small" x="490" y="398" text-anchor="middle">x_t = √ᾱ_t x₀ + √(1-ᾱ_t) ε</text>
  <text class="small" x="490" y="420" text-anchor="middle">ε ~ N(0, I)</text>

  <!-- Denoising network -->
  <rect class="box" x="680" y="310" width="260" height="160" />
  <text class="label" x="810" y="345" text-anchor="middle">Denoising Network</text>
  <text class="small" x="810" y="370" text-anchor="middle">ε_θ(x_t, t, context, adj)</text>
  <text class="small" x="810" y="392" text-anchor="middle">Transformer + GCN/GAT</text>
  <text class="small" x="810" y="414" text-anchor="middle">predict noise / x₀</text>

  <!-- Sampling -->
  <rect class="box" x="980" y="340" width="190" height="110" />
  <text class="label" x="1075" y="372" text-anchor="middle">DDIM Sampling</text>
  <text class="small" x="1075" y="395" text-anchor="middle">Iterative denoise</text>
  <text class="small" x="1075" y="418" text-anchor="middle">→ future prediction</text>

  <!-- Output / metrics -->
  <rect class="box" x="980" y="500" width="190" height="110" />
  <text class="label" x="1075" y="532" text-anchor="middle">Ensemble</text>
  <text class="small" x="1075" y="555" text-anchor="middle">median / CRPS</text>
  <text class="small" x="1075" y="578" text-anchor="middle">MAE/RMSE</text>

  <!-- Arrows: inputs to context encoder -->
  <line class="arrow" x1="300" y1="115" x2="360" y2="175" />
  <line class="arrow" x1="300" y1="205" x2="360" y2="205" />
  <line class="arrow" x1="300" y1="295" x2="360" y2="235" />

  <!-- DID to future known (feature concat) -->
  <line class="arrow" x1="300" y1="525" x2="360" y2="260" />
  <text class="small" x="320" y="285" text-anchor="start">concat DID → future known</text>

  <!-- Residual path (dashed) -->
  <line class="arrow dash" x1="300" y1="645" x2="360" y2="380" />
  <text class="small" x="320" y="420" text-anchor="start">residual target (optional)</text>

  <!-- Adjacency to denoiser -->
  <line class="arrow" x1="300" y1="385" x2="680" y2="385" />

  <!-- Context encoder to denoiser -->
  <line class="arrow" x1="620" y1="220" x2="680" y2="350" />

  <!-- Forward diffusion to denoiser -->
  <line class="arrow" x1="620" y1="400" x2="680" y2="400" />

  <!-- Denoiser to sampling -->
  <line class="arrow" x1="940" y1="385" x2="980" y2="385" />

  <!-- Sampling to metrics -->
  <line class="arrow" x1="1075" y1="450" x2="1075" y2="500" />
</svg>
